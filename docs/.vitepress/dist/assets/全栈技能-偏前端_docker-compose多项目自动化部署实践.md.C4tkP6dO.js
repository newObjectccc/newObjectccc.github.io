import{_ as s,c as i,o as a,a4 as n}from"./chunks/framework.nQaBHiNx.js";const o=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"å…¨æ ˆæŠ€èƒ½-åå‰ç«¯/docker-composeå¤šé¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ.md","filePath":"å…¨æ ˆæŠ€èƒ½-åå‰ç«¯/docker-composeå¤šé¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ.md"}'),e={name:"å…¨æ ˆæŠ€èƒ½-åå‰ç«¯/docker-composeå¤šé¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ.md"},p=n(`<h1 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">â€‹</a></h1><h2 id="ğŸš€docker-composeè‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ" tabindex="-1">ğŸš€docker-composeè‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ <a class="header-anchor" href="#ğŸš€docker-composeè‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ" aria-label="Permalink to &quot;ğŸš€docker-composeè‡ªåŠ¨åŒ–éƒ¨ç½²å®è·µ&quot;">â€‹</a></h2><p>ç›¸ä¿¡æœ‰å¾ˆå¤šå°ä¼™ä¼´æœ‰å¯¹ Docker å’Œ docker-compose çš„éƒ¨ç½²æœ‰ç‚¹ç–‘æƒ‘ï¼Œæœ¬æ–‡ä¼šä»¥æˆ‘è‡ªå·±çš„ä¸€ä¸ªé¡¹ç›®éƒ¨ç½²æ¡ˆä¾‹æ¥è®²è¿°ã€‚</p><p><em>è¿™æ˜¯æˆ‘ä»¬çš„ç²—ç•¥æ¶æ„</em>:</p><ul><li>ApiGatewayä¹Ÿæ˜¯ç”¨ Nestjs</li><li>Nginx åšè´Ÿè½½å‡è¡¡</li><li>åç«¯Servicesæ˜¯ç”¨ Nestjs</li></ul><p><img src="https://github.com/newObjectccc/newObjectccc.github.io/assets/42132586/602e3994-1e9a-4292-88d5-7de9bce4852b" alt="image"></p><p>here we goï¼ğŸš€</p><p>ğŸ’¡psï¼šä»¥ä¸‹æ˜¯åŸºäº <code>docker-compose</code> å“Ÿï¼Œå¦‚æœä½ æ²¡æœ‰ <code>docker</code> å’Œ <code>docker-compose</code> çš„å‰ç½®çŸ¥è¯†ï¼Œè¯·é€‚å½“äº†è§£ä¸€ä¸‹å†çœ‹ï¼Œä¸è¿‡ç›¸ä¿¡æˆ‘ï¼Œå°±ç®—ä½ ä¸ç†Ÿæ‚‰ï¼Œåªè¦ä½ ä¼šå®‰è£… <code>docker</code> å’Œ <code>docker-compose</code> å°±å¯ä»¥ï¼Œè¿™éƒ¨åˆ†ä¸ä¼šè¯·è‡ªè¡Œ<code>google</code>ã€‚</p><p>æˆ‘ç”¨<code>DevOps</code>å¹³å°æ˜¯ <strong>gitee</strong></p><p><code>Docker</code>é•œåƒæºæ˜¯ <strong>é˜¿é‡Œäº‘</strong></p><p>è®°å¾—åœ¨å¼€å§‹ä¹‹å‰æå‰å®‰è£…å¥½ä½ çš„ <code>docker</code> å’Œ <code>docker-compose</code>ï¼Œç”šè‡³æ˜¯ä½ çš„ <code>git</code> ä»“åº“ï¼Œä¹Ÿè¯·åˆ«å¿˜è®°è¦æ‰“é€š <code>gitee</code> çš„è¯ï¼Œè®°å¾—å»ç»‘å®šè¿œç¨‹å®ä¾‹å“Ÿ~</p><h3 id="æ­£æ–‡å¼€å§‹ğŸ‘‰" tabindex="-1">æ­£æ–‡å¼€å§‹ğŸ‘‰ <a class="header-anchor" href="#æ­£æ–‡å¼€å§‹ğŸ‘‰" aria-label="Permalink to &quot;æ­£æ–‡å¼€å§‹ğŸ‘‰&quot;">â€‹</a></h3><hr><p>è¿™é‡Œç»™å‡ºé¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š</p><p><img src="https://github.com/newObjectccc/newObjectccc.github.io/assets/42132586/46e2d9d3-e0b2-461a-a124-a6883c4c9720" alt="image"></p><h4 id="_1-é¦–å…ˆåœ¨æˆ‘ä»¬çš„åç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º-dockerfileğŸ“Œ" tabindex="-1">1. é¦–å…ˆåœ¨æˆ‘ä»¬çš„åç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º DockerfileğŸ“Œ <a class="header-anchor" href="#_1-é¦–å…ˆåœ¨æˆ‘ä»¬çš„åç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º-dockerfileğŸ“Œ" aria-label="Permalink to &quot;1. é¦–å…ˆåœ¨æˆ‘ä»¬çš„åç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º DockerfileğŸ“Œ&quot;">â€‹</a></h4><p>é…ç½®å¥½æˆ‘ä»¬çš„ Dockerfileï¼Œ ä»¥ä¾¿åç»­æ„å»º imageï¼Œé…ç½®æ¯”è¾ƒç®€å•æˆ‘å°±ä¸å¤šèµ˜è¿°äº†ã€‚ ğŸ’¡<em>psï¼šæ³¨æ„æ˜¯åœ¨å­é¡¹ç›®<code>kch-backend</code>æ ¹ç›®å½•é‡Œé…ç½®å“¦</em></p><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:18</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install -g pnpm</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pnpm install</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-F&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kch-backend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start:prod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>ç„¶ååœ¨ <code>Monorepo</code> çš„æ ¹ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»™ä½ åç«¯ç¨‹åºå®šä¹‰ä¸€ä¸ª service name è¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢æˆ‘ä¼šè¯´ä¸ºä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cqbackend1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3000:3000&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»™ä½ åç«¯ç¨‹åºå®šä¹‰ä¸€ä¸ª service name è¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢æˆ‘ä¼šè¯´ä¸ºä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cqbackend2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3001:3001&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»™ä½ åç«¯ç¨‹åºå®šä¹‰ä¸€ä¸ª service name è¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢æˆ‘ä¼šè¯´ä¸ºä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cqbackend3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3002:3002&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»™ä½ åç«¯ç¨‹åºå®šä¹‰ä¸€ä¸ª service name è¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢æˆ‘ä¼šè¯´ä¸ºä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cqbackend4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3003:3003&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # éœ€è¦ç”¨åˆ° nginx åšè´Ÿè½½å‡è¡¡</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;81:81&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å°†å½“å‰ç›®å½•çš„ nginx.conf é…ç½®æ–‡ä»¶ç»‘å®šåˆ°é•œåƒä¸­çš„ /etc/nginx/nginx.conf ä¸Š</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./nginx.conf:/etc/nginx/nginx.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç­‰æ‰€æœ‰é¡¹ç›®éƒ½éƒ¨ç½²å¥½äº†ï¼Œå†è¿›è¡Œ nginx éƒ¨ç½²</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cqapigateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cqapigateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-apigateway:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;80:80&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cqbackend1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cqbackend2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cqbackend3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cqbackend4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mysql:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123456</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      MYSQL_DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kch_database</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db-data:/var/lib/mysql</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  db-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div><p>å› ä¸ºç”¨åˆ°äº† nginx.conf æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨æ ¹ç›®å½•ä¸‹åšå¦‚ä¸‹ nginx é…ç½®ï¼Œè¿™é‡Œå„ä½è¯·æŒ‰éœ€é…ç½®ï¼Œæˆ‘åªç»™å‡ºçš„æ˜¯é»˜è®¤é…ç½®ï¼š</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> app_servers </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¹‹å‰æˆ‘è¯´ service name å¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œéœ€è¦é€šè¿‡ name æ¥è®¿é—®ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cqbackend1:3000;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¹‹å‰æˆ‘è¯´ service name å¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œéœ€è¦é€šè¿‡ name æ¥è®¿é—®ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cqbackend1:3001;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¹‹å‰æˆ‘è¯´ service name å¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œéœ€è¦é€šè¿‡ name æ¥è®¿é—®ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cqbackend2:3002;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¹‹å‰æˆ‘è¯´ service name å¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œéœ€è¦é€šè¿‡ name æ¥è®¿é—®ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cqbackend3:3003;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">81</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rysyclub.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://app_servers;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ğŸ’¡<em>psï¼šæ³¨æ„ä¹‹å‰æˆ‘è¯´ <code>service name</code> å¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œéœ€è¦é€šè¿‡ <code>name</code> æ¥è®¿é—®ç«¯å£ï¼Œè€Œä¸æ˜¯localhostï¼Œè¿™æ˜¯å› ä¸º <code>docker</code> æœ‰å†…å»ºçš„ <code>network</code> ç¯å¢ƒï¼ˆè¿™ä¸æ˜¯æŒ‡ä½ çš„æœåŠ¡å™¨ä¸Šçš„ç½‘ç»œå“Ÿï¼ï¼‰ï¼Œæ‰€ä»¥ä½ è¦ä¹ˆé…ç½®ç½‘ç»œlinkï¼Œè¦ä¹ˆéƒ¨ç½²åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹ï¼Œäº‹å®ä¸ŠåŒä¸€ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶ä¸­çš„ <code>services</code> ä¼šéƒ¨ç½²åœ¨åŒä¸€ä¸ª default ç½‘ç»œä¸‹ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦é€šè¿‡ <code>service name</code> æ‰èƒ½è®¿é—®ï¼Œå¦åˆ™ä¼šè¢«æ‹’ç»è®¿é—®ï¼Œè¿™ä¸ªé—®é¢˜æ›¾å›°æ‰°æˆ‘24å°æ—¶ï¼Œè¿™å°±æ˜¯ä¸å¥½å¥½çœ‹æ–‡æ¡£çš„åæœã€‚ğŸ˜‚ï¼ˆäº‹å®ä¸Šä¸ä»…ä»…æ˜¯ <code>nginx</code> éœ€è¦è¿™æ ·é…ç½®ï¼Œä½ çš„æœåŠ¡å™¨ä¸Šçš„æœåŠ¡é—´ä¸åŒç«¯å£éœ€è¦äº’é€šä¹Ÿæ˜¯åŒç†ï¼Œåªè¦ä»–ä»¬éƒ½æ˜¯ç”¨ <code>docker</code>ï¼‰æ¯”å¦‚æˆ‘çš„ <code>apigateway</code> æœåŠ¡å†…éƒ¨æ˜¯é€šè¿‡ <code>http://nginx:81</code> è®¿é—® <code>Nginx</code> çš„ã€‚</em></p><p>okk~ å‰©ä¸‹çš„å·¥ä½œï¼Œä½ åªéœ€è¦é…ç½®å¥½ä½ çš„ <code>gitee</code> æµæ°´çº¿å°±å¯ä»¥äº†ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><p>æ€»ä½“æ¥è¯´å°±æ˜¯ç­‰å¾… <code>cqbackend</code> å’Œ <code>apigateway</code> é•œåƒæ‰“åŒ…å®Œæˆä¹‹åå†è¿›è¡Œä¸»æœºéƒ¨ç½²</p><p><img src="https://github.com/newObjectccc/newObjectccc.github.io/assets/42132586/57603283-cedd-4cba-9328-3f030eb6f02a" alt="image"></p><p>ğŸ’¡<em>psï¼šå¦‚æœä½ æƒ³ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½ ç”¨ <code>pipeline</code> æµ‹è¯•ä½ çš„ç¨‹åºï¼Œé€šè¿‡ä¹‹åå†è¿›è¡Œä¸»æœºéƒ¨ç½²</em></p><p>è¿™æ˜¯åœ¨æµæ°´çº¿ä¸­ <code>ä¸»æœºéƒ¨ç½²</code> é‡Œéœ€è¦çš„ <code>bash</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿›å…¥åˆ°ä½ çš„å·¥ä½œç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/gitee_go/cq-backend</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŒæ­¥ä¸€ä¸‹è¿œç¨‹ä»“åº“çš„åˆ†æ”¯ï¼Œè¿™é‡Œæˆ‘æ˜¯åŒæ­¥çš„ featureï¼Œä½†é€šå¸¸æ˜¯ release åˆ†æ”¯æ‰å¯¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> feature</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‹‰å–è¯¥åˆ†æ”¯ä¸‹æ ¹ç›®å½•çš„ docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin/feature</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‹‰å–è¯¥åˆ†æ”¯ä¸‹æ ¹ç›®å½•çš„ docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin/feature</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…ˆåœæ‰å½“å‰çš„å®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ é™¤ imageï¼Œä»¥ä¾¿é‡æ–°æ‹‰å–æœ€æ–°çš„ image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rmi</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-apigateway:latest</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ é™¤ imageï¼Œä»¥ä¾¿é‡æ–°æ‹‰å–æœ€æ–°çš„ image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rmi</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-chengdu.aliyuncs.com/gitee-docker/cq-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åå°å¯åŠ¨~</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --remove-orphans</span></span></code></pre></div><p>ğŸ’¡<em>psï¼šè¯·æ³¨æ„ï¼Œä»¥ä¸Š <code>git</code> éƒ¨åˆ†è¦ç”Ÿæ•ˆéœ€è¦ä½ æå‰åœ¨ä½ çš„å·¥ä½œç›®å½•ä¸­ï¼ˆ<code>cd ~/gitee_go/cq-backend</code>ï¼‰åˆ›å»º <code>git</code> ä»“åº“ï¼Œcheckout 2ä¸ªéƒ¨ç½²æ–‡ä»¶å°±å¯ä»¥äº†ï¼Œè¿™æ ·ä½ çš„ <code>git</code> ä»“åº“å°±åªæœ‰è¿™ä¿©æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ª <code>monorepo</code></em></p><p>å»ºè®®ä½ sshåˆ°ä½ çš„å®ä¾‹ä¸Šå»ç”¨ <code>docker ps</code> éªŒè¯ä¸€ä¸‹ï¼Œå¦‚æœè¾“å‡ºå¦‚ä¸‹ï¼Œé‚£ä¾¿æ²¡å•¥é—®é¢˜äº†ï¼š</p><p><img src="https://github.com/newObjectccc/newObjectccc.github.io/assets/42132586/32064f66-781b-4ed9-9698-9438f43549db" alt="image"></p><p>ğŸ’¡<em>psï¼šè¿™æ˜¯ä¸€ä¸ªå…¥é—¨ç¤ºä¾‹ï¼Œè¯·åˆ«ç›´æ¥ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä½ è¿˜éœ€è¦åšæ›´å¤šçš„å®¹é”™å’Œ <code>backup</code> çš„æ–¹æ¡ˆï¼Œè‡³å°‘ä½ çš„ <code>CI</code> éœ€è¦æ›´å¤šçš„æµ‹è¯•ç›¸å…³ <code>pipeline</code> , <code>CD</code> ä¸Šä½ éœ€è¦å¯¹æ¯ä¸€ä¸ªæœåŠ¡è¿›è¡Œè¾ƒä¸ºå®Œå–„çš„ç›‘æ§ï¼Œåšå¥½é¢„è­¦ç­‰æªæ–½ï¼Œå¹¶ä¸”ä½ çš„æ•°æ®åº“ä¹Ÿåº”è¯¥æœ‰å¤‡ä»½æœºåˆ¶ç­‰ã€‚</em></p><hr><p>ğŸ˜Šokk~ è¿™å°±æ˜¯æˆ‘çš„å…¥é—¨å®è·µäº†ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ï¼Œèµ¶ç´§å»éƒ¨ç½²ä½ çš„åº”ç”¨å§~</p>`,35),l=[p];function k(h,t,c,d,E,r){return a(),i("div",null,l)}const y=s(e,[["render",k]]);export{o as __pageData,y as default};
